#!/usr/bin/env python
#
# Install Python modules in the python-packages.txt requirements file.

import sys
import os
import subprocess
import distutils.spawn


def emulate_run(s):
    if subprocess.call(s, shell=True) == 0:
        return True
    return False


def emulate_backtick(s):
    try:
        output = subprocess.check_output(s, shell=True).rstrip("\n")
    except:
        output = ""

    return output

HOME = os.environ["HOME"]

python = distutils.spawn.find_executable("python")
if not python:
    print "error: Python not installed, not installing Python packages."
    sys.exit(1)

pip = os.path.join(emulate_backtick(python + " -c 'import site ; print site.USER_BASE'"), "bin", "pip")
if not os.path.exists(pip):
    emulate_run("wget https://bootstrap.pypa.io/get-pip.py")
    if not os.path.exists("get-pip.py"):
        print "warning: pip failed to install, not installing Python packages."
        sys.exit(1)

    emulate_run(python + " get-pip.py --user")
    os.remove("get-pip.py")

if not os.path.exists(pip):
    print "error: pip not installing, not installing Python packages."
    sys.exit(1)

emulate_run(pip + " install --user --upgrade -r python-packages.txt")
