#!/usr/bin/env python
#
# Install Node packages in the node-packages.txt package list.

import sys
import os
import subprocess


def emulate_run(s):
    if subprocess.call(s, shell=True) == 0:
        return True
    return False


def emulate_backtick(s):
    try:
        output = subprocess.check_output(s, shell=True).rstrip("\n")
    except:
        output = ""

    return output

HOME = os.environ["HOME"]

node = emulate_backtick("which node 2> /dev/null")
if node == "":
    node = emulate_backtick("which nodejs 2> /dev/null")
    if node == "":
        print "error: node is not installed, skipping node module installation"
        sys.exit(1)

npm = emulate_backtick("which npm 2> /dev/null")
if npm == "":
    print "error: npm is not installed, skipping node module installation"
    sys.exit(1)

node_packages = emulate_backtick("grep -v \"^#\" node-packages.txt")
for m in node_packages.split():
    emulate_run(npm + " install --global --prefix=\"" + os.path.join(HOME, ".node_modules") + "\" \"" + m + "\"")
